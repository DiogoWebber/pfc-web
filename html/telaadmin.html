<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin</title>
    <link rel="stylesheet" href="../styles.css">
</head>

<body>
    <div class="container">
        <h2>Admin</h2>
        <div class="buttons">
            <button onclick="window.location.href='/cadastro-receitas-despesas.html'">Cadastro de Receitas e
                Despesas</button>
            <button onclick="window.location.href='/lembrete.html'">Lembrete</button>
            <button onclick="window.location.href='/autenticador.html'">Autenticador</button>
            <button onclick="window.location.href='/cadastro-contas.html'">Cadastro de Contas</button>
            <button onclick="window.location.href='/cadastro-usuarios.html'">Cadastro de Usuários</button>
        </div>
    </div>
    <div class="container">
        <h2>Controle de Finanças</h2>
        <div class="summary-section">
            <div class="summary-box">
                <h3>Entrada</h3>
                <p>R$ <span id="entryTotal">0.00</span></p>
            </div>
            <div class="summary-box">
                <h3>Saída</h3>
                <p>R$ <span id="exitTotal">0.00</span></p>
            </div>
            <div class="summary-box">
                <h3>Total</h3>
                <p>R$ <span id="total">0.00</span></p>
            </div>
        </div>
        <div class="entry-section">
            <h3>Nova Transação</h3>
            <div class="entry-form">
                <input type="text" id="description" placeholder="Descrição" required>
                <input type="text" id="value" placeholder="Valor" required>
                <select id="type">
                    <option value="entry">Entrada</option>
                    <option value="exit">Saída</option>
                </select>
                <button onclick="submitTransaction()">Incluir</button>
            </div>
        </div>
        <table class="transaction-table">
            <thead>
                <tr>
                    <th>Descrição</th>
                    <th>Valor</th>
                    <th>Tipo</th>
                </tr>
            </thead>
            <tbody id="transactionBody">
                <!-- Aqui serão adicionadas as transações -->
            </tbody>
        </table>
    </div>
    <script>
        // Função para enviar a nova transação para o servidor
        function submitTransaction() {
            const description = document.getElementById('description').value;
            const value = parseFloat(document.getElementById('value').value);
            const type = document.getElementById('type').value;

            if (!description || isNaN(value) || !type) {
                alert('Por favor, preencha todos os campos corretamente.');
                return;
            }

            const transaction = { description, value, type };
            console.log(description, value, type)
            fetch('/api/transactions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(transaction)
            })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error('Erro ao adicionar transação');
                })
                .then(data => {
                    if (data.success) {
                        // Se a transação for adicionada com sucesso, atualizar a tabela de transações e os totais
                        updateTransactionTable();
                        updateTotals();
                    } else {
                        // Se houver algum erro, exibir uma mensagem de erro
                        alert('Erro ao adicionar transação. Por favor, tente novamente.');
                    }
                })
                .catch(error => {
                    console.error('Erro:', error);
                    alert('Erro ao adicionar transação. Por favor, tente novamente.');
                });
        }

        // Função para atualizar a tabela de transações
        function updateTransactionTable() {
            fetch('/api/transactions')
                .then(response => response.json())
                .then(transactions => {
                    const tableBody = document.getElementById('transactionBody');
                    tableBody.innerHTML = '';

                    transactions.forEach(transaction => {
                        const newRow = document.createElement('tr');

                        const descriptionCell = document.createElement('td');
                        descriptionCell.textContent = transaction.description;

                        const valueCell = document.createElement('td');
                        valueCell.textContent = transaction.value !== undefined ? transaction.value.toFixed(2) : '';

                        const typeCell = document.createElement('td');
                        typeCell.textContent = transaction.type === 'entry' ? 'Entrada' : 'Saída';

                        newRow.appendChild(descriptionCell);
                        newRow.appendChild(valueCell);
                        newRow.appendChild(typeCell);

                        tableBody.appendChild(newRow);
                    });
                })
                .catch(error => console.error('Erro:', error));
        }

        // Função para atualizar os totais de entrada, saída e saldo final
        function updateTotals() {
            fetch('/api/transactions')
                .then(response => response.json())
                .then(transactions => {
                    let entryTotal = 0;
                    let exitTotal = 0;

                    transactions.forEach(transaction => {
                        if (transaction.type === 'entry') {
                            entryTotal += transaction.value;
                        } else if (transaction.type === 'exit') {
                            exitTotal += transaction.value;
                        }
                    });

                    const totalEntryElement = document.getElementById('entryTotal');
                    totalEntryElement.textContent = entryTotal.toFixed(2);

                    const totalExitElement = document.getElementById('exitTotal');
                    totalExitElement.textContent = exitTotal.toFixed(2);

                    const totalElement = document.getElementById('total');
                    const total = entryTotal - exitTotal;
                    totalElement.textContent = total.toFixed(2);
                })
                .catch(error => console.error('Erro:', error));
        }

        // Carregar as transações e os totais ao carregar a página
        updateTransactionTable();
        updateTotals();
    </script>

</body>

</html>